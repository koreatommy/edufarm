# Google Drive í´ë” ì‚¬ì§„ ì›¹ ì„œë¹„ìŠ¤ ê°€ì´ë“œë¼ì¸

ì´ ë¬¸ì„œëŠ” Google Drive í´ë”ì˜ ì‚¬ì§„ì„ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì„œë¹„ìŠ¤í•˜ê¸° ìœ„í•œ ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. Next.jsì™€ Google Drive API v3ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ì‚¬ì „ ì¤€ë¹„](#1-ì‚¬ì „-ì¤€ë¹„)
2. [Google Cloud Console ì„¤ì •](#2-google-cloud-console-ì„¤ì •)
3. [Google Drive í´ë” ê³µìœ  ì„¤ì •](#3-google-drive-í´ë”-ê³µìœ -ì„¤ì •)
4. [í”„ë¡œì íŠ¸ ì„¤ì •](#4-í”„ë¡œì íŠ¸-ì„¤ì •)
5. [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#5-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
6. [API ë¼ìš°íŠ¸ êµ¬í˜„](#6-api-ë¼ìš°íŠ¸-êµ¬í˜„)
7. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„](#7-í”„ë¡ íŠ¸ì—”ë“œ-êµ¬í˜„)
8. [ë°°í¬](#8-ë°°í¬)
9. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#9-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
10. [ì£¼ìš” ì£¼ì˜ì‚¬í•­](#10-ì£¼ìš”-ì£¼ì˜ì‚¬í•­)

---

## 1. ì‚¬ì „ ì¤€ë¹„

### í•„ìš”í•œ ê²ƒë“¤

- Google ê³„ì •
- Google Cloud Console ì ‘ê·¼ ê¶Œí•œ
- Google Drive í´ë” (ì´ë¯¸ì§€ íŒŒì¼ í¬í•¨)
- Next.js í”„ë¡œì íŠ¸ (16.0 ì´ìƒ ê¶Œì¥)
- Node.js 18 ì´ìƒ

### í•„ìš”í•œ íŒ¨í‚¤ì§€

```bash
npm install googleapis
```

---

## 2. Google Cloud Console ì„¤ì •

### 2.1 í”„ë¡œì íŠ¸ ìƒì„±

1. [Google Cloud Console](https://console.cloud.google.com/) ì ‘ì†
2. ìƒë‹¨ í”„ë¡œì íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ í´ë¦­
3. "ìƒˆ í”„ë¡œì íŠ¸" í´ë¦­
4. í”„ë¡œì íŠ¸ ì´ë¦„ ì…ë ¥ (ì˜ˆ: `photo-gallery`)
5. "ë§Œë“¤ê¸°" í´ë¦­

### 2.2 Google Drive API í™œì„±í™”

1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ **"API ë° ì„œë¹„ìŠ¤"** â†’ **"ë¼ì´ë¸ŒëŸ¬ë¦¬"** ì„ íƒ
2. ê²€ìƒ‰ì°½ì— "Google Drive API" ì…ë ¥
3. **"Google Drive API"** ì„ íƒ
4. **"ì‚¬ìš© ì„¤ì •"** í´ë¦­

### 2.3 Service Account ìƒì„±

1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ **"API ë° ì„œë¹„ìŠ¤"** â†’ **"ì‚¬ìš©ì ì¸ì¦ ì •ë³´"** ì„ íƒ
2. ìƒë‹¨ **"ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°"** í´ë¦­
3. **"ì„œë¹„ìŠ¤ ê³„ì •"** ì„ íƒ
4. ì„œë¹„ìŠ¤ ê³„ì • ì •ë³´ ì…ë ¥:
   - **ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„**: `google-drive-service` (ì›í•˜ëŠ” ì´ë¦„)
   - **ì„œë¹„ìŠ¤ ê³„ì • ID**: ìë™ ìƒì„±ë¨
   - **ì„¤ëª…**: "Google Drive ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ìš© ì„œë¹„ìŠ¤ ê³„ì •"
5. **"ë§Œë“¤ê³  ê³„ì†í•˜ê¸°"** í´ë¦­
6. ì—­í• ì€ ê±´ë„ˆë›°ê³  **"ì™„ë£Œ"** í´ë¦­

### 2.4 Service Account í‚¤ ìƒì„±

1. ìƒì„±ëœ ì„œë¹„ìŠ¤ ê³„ì • í´ë¦­
2. **"í‚¤"** íƒ­ ì„ íƒ
3. **"í‚¤ ì¶”ê°€"** â†’ **"ìƒˆ í‚¤ ë§Œë“¤ê¸°"** í´ë¦­
4. í‚¤ ìœ í˜•: **"JSON"** ì„ íƒ
5. **"ë§Œë“¤ê¸°"** í´ë¦­
6. JSON íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë¨

**âš ï¸ ì¤‘ìš”**: ì´ JSON íŒŒì¼ì€ **ì ˆëŒ€ ê³µê°œ ì €ì¥ì†Œì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”!**

### 2.5 JSON í‚¤ íŒŒì¼ êµ¬ì¡°

ë‹¤ìš´ë¡œë“œëœ JSON íŒŒì¼ êµ¬ì¡°:

```json
{
  "type": "service_account",
  "project_id": "your-project-id",
  "private_key_id": "...",
  "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
  "client_email": "service-account@project-id.iam.gserviceaccount.com",
  "client_id": "...",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "..."
}
```

í•„ìš”í•œ ì •ë³´:
- `client_email`: Service Account ì´ë©”ì¼ ì£¼ì†Œ
- `private_key`: Private Key (ì¤„ë°”ê¿ˆ í¬í•¨)

---

## 3. Google Drive í´ë” ê³µìœ  ì„¤ì •

### 3.1 í´ë” ID í™•ì¸

1. Google Driveì—ì„œ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  í´ë” ì—´ê¸°
2. URLì—ì„œ í´ë” ID í™•ì¸:
   ```
   https://drive.google.com/drive/folders/[FOLDER_ID]
   ```
   ì˜ˆ: `https://drive.google.com/drive/folders/1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT`
   â†’ í´ë” ID: `1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT`

### 3.2 Service Accountì— í´ë” ê³µìœ 

1. Google Driveì—ì„œ í´ë” ìš°í´ë¦­
2. **"ê³µìœ "** í´ë¦­
3. **"ì‚¬ìš©ì ë° ê·¸ë£¹ ì¶”ê°€"** ì…ë ¥ë€ì— Service Account ì´ë©”ì¼ ì…ë ¥
   - ì˜ˆ: `google-drive-service@your-project-id.iam.gserviceaccount.com`
4. ê¶Œí•œ: **"ë·°ì–´"** ì„ íƒ (ì½ê¸° ì „ìš©)
5. **"ì™„ë£Œ"** í´ë¦­

**âœ… í™•ì¸**: Service Accountê°€ ê³µìœ  ëª©ë¡ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

## 4. í”„ë¡œì íŠ¸ ì„¤ì •

### 4.1 íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install googleapis
```

### 4.2 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
your-project/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ api/
â”‚       â”‚   â””â”€â”€ google-drive/
â”‚       â”‚       â”œâ”€â”€ route.ts                    # ì´ë¯¸ì§€ ëª©ë¡ API
â”‚       â”‚       â””â”€â”€ image/
â”‚       â”‚           â””â”€â”€ [fileId]/
â”‚       â”‚               â””â”€â”€ route.ts            # ì´ë¯¸ì§€ í”„ë¡ì‹œ API
â”‚       â””â”€â”€ results/
â”‚           â””â”€â”€ page.tsx                       # ê°¤ëŸ¬ë¦¬ í˜ì´ì§€
â”œâ”€â”€ .env.local                                 # ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜
â””â”€â”€ package.json
```

---

## 5. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### 5.1 ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜ (`.env.local`)

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env.local` íŒŒì¼ ìƒì„±:

```env
# Google Drive í´ë” ID
DRIVE_FOLDER_ID=1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT

# Service Account ì´ë©”ì¼ (JSON íŒŒì¼ì˜ client_email)
GOOGLE_SERVICE_ACCOUNT_EMAIL=google-drive-service@your-project-id.iam.gserviceaccount.com

# Private Key (JSON íŒŒì¼ì˜ private_key)
# âš ï¸ ì£¼ì˜: ì¤„ë°”ê¿ˆ ë¬¸ì(\n)ë¥¼ ê·¸ëŒ€ë¡œ í¬í•¨í•´ì•¼ í•¨
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...\n-----END PRIVATE KEY-----\n"
```

**âš ï¸ ì¤‘ìš” ì£¼ì˜ì‚¬í•­**:

1. **Private KeyëŠ” í°ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°**
2. **ì¤„ë°”ê¿ˆ ë¬¸ì(`\n`)ë¥¼ ê·¸ëŒ€ë¡œ í¬í•¨**
3. **ì•ë’¤ ê³µë°± ì—†ì´ ì‘ì„±**
4. **`.env.local`ì€ `.gitignore`ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸**

### 5.2 í™˜ê²½ ë³€ìˆ˜ ì²˜ë¦¬ ì½”ë“œ íŒ¨í„´

ì½”ë“œì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” **ë°˜ë“œì‹œ `.trim()`ì„ ì‚¬ìš©**í•˜ì„¸ìš”:

```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
const folderId = process.env.DRIVE_FOLDER_ID?.trim();
const serviceAccountEmail = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL?.trim();
const privateKey = process.env.GOOGLE_PRIVATE_KEY?.trim();

// âŒ ì˜ëª»ëœ ë°©ë²• (ì¤„ë°”ê¿ˆ ë¬¸ìë¡œ ì¸í•œ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥)
const folderId = process.env.DRIVE_FOLDER_ID;
```

---

## 6. API ë¼ìš°íŠ¸ êµ¬í˜„

### 6.1 ì´ë¯¸ì§€ ëª©ë¡ API (`/api/google-drive/route.ts`)

#### ì£¼ìš” ê¸°ëŠ¥

- Google Drive í´ë”ì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ ëª©ë¡ ì¡°íšŒ
- í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì› (í˜ì´ì§€ë‹¹ 30ê°œ)
- ìµœì‹  íŒŒì¼ë¶€í„° ì •ë ¬
- Service Account ì¸ì¦

#### í•µì‹¬ ì½”ë“œ íŒ¨í„´

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { google } from 'googleapis';

/**
 * Google Drive Service Account ì¸ì¦ ë° API í´ë¼ì´ì–¸íŠ¸ ìƒì„±
 */
function getGoogleDriveClient() {
  // âš ï¸ ë°˜ë“œì‹œ .trim() ì‚¬ìš©
  const serviceAccountEmail = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL?.trim();
  const privateKey = process.env.GOOGLE_PRIVATE_KEY?.trim();

  if (!serviceAccountEmail || !privateKey) {
    throw new Error('í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
  }

  // Private Key ì²˜ë¦¬
  // 1. í°ë”°ì˜´í‘œ ì œê±° (í™˜ê²½ ë³€ìˆ˜ì— í¬í•¨ëœ ê²½ìš°)
  let cleanedPrivateKey = privateKey.replace(/^["']|["']$/g, '');
  // 2. ì´ìŠ¤ì¼€ì´í”„ëœ \nì„ ì‹¤ì œ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë³€í™˜
  const formattedPrivateKey = cleanedPrivateKey.replace(/\\n/g, '\n');

  // JWT ì¸ì¦ ì„¤ì •
  const auth = new google.auth.JWT({
    email: serviceAccountEmail,
    key: formattedPrivateKey,
    scopes: ['https://www.googleapis.com/auth/drive.readonly'],
  });

  return google.drive({ version: 'v3', auth });
}

export async function GET(request: NextRequest) {
  try {
    // âš ï¸ í´ë” IDë„ .trim() ì‚¬ìš©
    const folderId = process.env.DRIVE_FOLDER_ID?.trim();
    
    if (!folderId) {
      return NextResponse.json(
        { error: 'DRIVE_FOLDER_IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' },
        { status: 500 }
      );
    }

    const drive = getGoogleDriveClient();

    // í´ë” ì ‘ê·¼ ê¶Œí•œ í™•ì¸
    try {
      await drive.files.get({
        fileId: folderId,
        fields: 'id, name',
      });
    } catch (folderError: any) {
      if (folderError?.code === 404) {
        throw new Error(`í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Service Accountì— í´ë” ê³µìœ  ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.`);
      } else if (folderError?.code === 403) {
        throw new Error(`í´ë” ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. Service Accountì— 'ë·°ì–´' ê¶Œí•œì„ ë¶€ì—¬í•˜ì„¸ìš”.`);
      }
      throw folderError;
    }

    // ì´ë¯¸ì§€ íŒŒì¼ ëª©ë¡ ì¡°íšŒ
    const response = await drive.files.list({
      q: `'${folderId}' in parents and mimeType contains 'image/' and trashed = false`,
      fields: 'files(id, name, thumbnailLink, webViewLink, createdTime, modifiedTime, mimeType), nextPageToken',
      orderBy: 'modifiedTime desc',
      pageSize: 30,
    });

    // ì‘ë‹µ ë°ì´í„° ë³€í™˜
    const images = response.data.files?.map((file) => ({
      id: file.id || '',
      name: file.name || 'Untitled',
      thumbnailLink: file.thumbnailLink || '',
      webViewLink: file.webViewLink || '',
      downloadUrl: `/api/google-drive/image/${file.id}`, // í”„ë¡ì‹œ URL
      apiUrl: `/api/google-drive/image/${file.id}`,
      createdTime: file.createdTime || '',
      modifiedTime: file.modifiedTime || '',
    })) || [];

    return NextResponse.json({
      images,
      pagination: {
        currentPage: 1,
        totalPages: Math.ceil((response.data.files?.length || 0) / 30),
        totalItems: response.data.files?.length || 0,
        hasNextPage: !!response.data.nextPageToken,
        hasPreviousPage: false,
      },
    });
  } catch (error) {
    console.error('Google Drive API ì˜¤ë¥˜:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜' },
      { status: 500 }
    );
  }
}
```

#### í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„

Google Drive APIëŠ” `pageToken`ì„ ì‚¬ìš©í•œ í˜ì´ì§€ë„¤ì´ì…˜ì„ ì§€ì›í•©ë‹ˆë‹¤:

```typescript
// ì „ì²´ ê°œìˆ˜ ì¡°íšŒ
let totalItems = 0;
let nextPageToken: string | undefined = undefined;

while (true) {
  const countResponse = await drive.files.list({
    q: `'${folderId}' in parents and mimeType contains 'image/' and trashed = false`,
    fields: 'nextPageToken, files(id)',
    pageSize: 1000,
    pageToken: nextPageToken,
  });
  
  totalItems += countResponse.data.files?.length || 0;
  nextPageToken = countResponse.data.nextPageToken || undefined;
  
  if (!nextPageToken) break;
}

// íŠ¹ì • í˜ì´ì§€ ë°ì´í„° ì¡°íšŒ
let currentPageToken: string | undefined = undefined;
for (let i = 1; i < page; i++) {
  const tempResponse = await drive.files.list({
    q: `'${folderId}' in parents and mimeType contains 'image/' and trashed = false`,
    fields: 'nextPageToken',
    pageSize: 30,
    pageToken: currentPageToken,
  });
  currentPageToken = tempResponse.data.nextPageToken || undefined;
  if (!currentPageToken) break;
}
```

### 6.2 ì´ë¯¸ì§€ í”„ë¡ì‹œ API (`/api/google-drive/image/[fileId]/route.ts`)

#### ì£¼ìš” ê¸°ëŠ¥

- ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ì„œë²„ì—ì„œ í”„ë¡ì‹œí•˜ì—¬ ì œê³µ
- í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì¸ì¦ ì—†ì´ ì•ˆì „í•˜ê²Œ ì´ë¯¸ì§€ ì œê³µ
- ì ì ˆí•œ ìºì‹œ í—¤ë” ì„¤ì •

#### í•µì‹¬ ì½”ë“œ íŒ¨í„´

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { google } from 'googleapis';

// getGoogleDriveClient()ëŠ” ìœ„ì™€ ë™ì¼

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ fileId: string }> | { fileId: string } }
) {
  try {
    // Next.js 16ì—ì„œëŠ” paramsê°€ Promiseì¼ ìˆ˜ ìˆìŒ
    const resolvedParams = await Promise.resolve(params);
    const { fileId } = resolvedParams;

    if (!fileId) {
      return NextResponse.json(
        { error: 'íŒŒì¼ IDê°€ í•„ìš”í•©ë‹ˆë‹¤.' },
        { status: 400 }
      );
    }

    const drive = getGoogleDriveClient();

    // íŒŒì¼ ì •ë³´ ì¡°íšŒ
    const fileInfo = await drive.files.get({
      fileId: fileId,
      fields: 'id, name, mimeType',
    });

    // ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ í™•ì¸
    const mimeType = fileInfo.data.mimeType || '';
    if (!mimeType.startsWith('image/')) {
      return NextResponse.json(
        { error: 'ì´ë¯¸ì§€ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.' },
        { status: 400 }
      );
    }

    // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (ê³ í•´ìƒë„)
    const imageResponse = await drive.files.get(
      {
        fileId: fileId,
        alt: 'media', // ì‹¤ì œ íŒŒì¼ ë‚´ìš© ë‹¤ìš´ë¡œë“œ
      },
      {
        responseType: 'arraybuffer',
      }
    );

    // Bufferë¡œ ë³€í™˜
    const imageBuffer = Buffer.from(imageResponse.data as ArrayBuffer);

    // ì´ë¯¸ì§€ ì‘ë‹µ ë°˜í™˜
    return new NextResponse(imageBuffer, {
      status: 200,
      headers: {
        'Content-Type': mimeType,
        'Content-Length': imageBuffer.length.toString(),
        'Cache-Control': 'public, max-age=3600, s-maxage=3600', // 1ì‹œê°„ ìºì‹œ
        'Content-Disposition': `inline; filename="${fileInfo.data.name || 'image'}"`,
      },
    });
  } catch (error) {
    console.error('ì´ë¯¸ì§€ í”„ë¡ì‹œ ì˜¤ë¥˜:', error);
    return NextResponse.json(
      { error: 'ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
      { status: 500 }
    );
  }
}
```

---

## 7. í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### 7.1 ê°¤ëŸ¬ë¦¬ ì»´í¬ë„ŒíŠ¸ ê¸°ë³¸ êµ¬ì¡°

```typescript
'use client';

import { useEffect, useState } from 'react';

interface DriveImage {
  id: string;
  name: string;
  thumbnailLink: string;
  webViewLink: string;
  downloadUrl: string;
  apiUrl: string;
  createdTime: string;
  modifiedTime: string;
}

export default function GalleryPage() {
  const [images, setImages] = useState<DriveImage[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [currentPage, setCurrentPage] = useState(1);
  const [pagination, setPagination] = useState({
    currentPage: 1,
    totalPages: 1,
    totalItems: 0,
    hasNextPage: false,
    hasPreviousPage: false,
  });

  const fetchImages = async () => {
    try {
      setIsLoading(true);
      const response = await fetch(`/api/google-drive?page=${currentPage}&limit=30`);
      
      if (!response.ok) {
        throw new Error('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const data = await response.json();
      setImages(data.images);
      setPagination(data.pagination);
    } catch (error) {
      console.error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    fetchImages();
  }, [currentPage]);

  return (
    <div>
      {isLoading ? (
        <div>ë¡œë”© ì¤‘...</div>
      ) : (
        <div className="grid grid-cols-3 gap-4">
          {images.map((image) => (
            <img
              key={image.id}
              src={image.apiUrl} // í”„ë¡ì‹œ URL ì‚¬ìš©
              alt={image.name}
              className="w-full h-auto"
            />
          ))}
        </div>
      )}
    </div>
  );
}
```

### 7.2 ìë™ ìƒˆë¡œê³ ì¹¨ êµ¬í˜„

Page Visibility APIë¥¼ ì‚¬ìš©í•˜ì—¬ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ìë™ ìƒˆë¡œê³ ì¹¨:

```typescript
useEffect(() => {
  const fetchImages = async () => {
    // ... fetch logic
  };

  let intervalId: NodeJS.Timeout;

  const handleVisibilityChange = () => {
    if (document.hidden) {
      // íƒ­ì´ ìˆ¨ê²¨ì§€ë©´ interval ì¤‘ì§€
      if (intervalId) {
        clearInterval(intervalId);
      }
    } else {
      // íƒ­ì´ í™œì„±í™”ë˜ë©´ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ í›„ interval ì‹œì‘
      fetchImages();
      intervalId = setInterval(fetchImages, 30000); // 30ì´ˆë§ˆë‹¤
    }
  };

  // ì´ˆê¸° ë¡œë“œ
  fetchImages();

  // í˜ì´ì§€ê°€ ë³´ì´ëŠ” ìƒíƒœì¼ ë•Œë§Œ ìë™ ìƒˆë¡œê³ ì¹¨ í™œì„±í™”
  if (!document.hidden) {
    intervalId = setInterval(fetchImages, 30000);
  }

  // Visibility change ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  document.addEventListener('visibilitychange', handleVisibilityChange);

  // Cleanup
  return () => {
    if (intervalId) {
      clearInterval(intervalId);
    }
    document.removeEventListener('visibilitychange', handleVisibilityChange);
  };
}, [currentPage]);
```

### 7.3 ì´ë¯¸ì§€ ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬

```typescript
const [imageErrors, setImageErrors] = useState<Set<string>>(new Set());

const handleImageError = (imageId: string, image: DriveImage) => {
  if (!imageErrors.has(imageId)) {
    setImageErrors(prev => new Set(prev).add(imageId));
    // í”„ë¡ì‹œ URL ì‹¤íŒ¨ ì‹œ ì¸ë„¤ì¼ë¡œ í´ë°±
    const img = document.querySelector(`img[data-id="${imageId}"]`) as HTMLImageElement;
    if (img && image.thumbnailLink) {
      img.src = image.thumbnailLink;
    }
  }
};

// ì‚¬ìš©
<img
  src={image.apiUrl}
  alt={image.name}
  data-id={image.id}
  onError={() => handleImageError(image.id, image)}
/>
```

### 7.4 ì´ë¯¸ì§€ ìµœì í™” êµ¬í˜„

#### ì¸ë„¤ì¼ í•´ìƒë„ ìµœì í™”

Google Drive APIì˜ ê¸°ë³¸ ì¸ë„¤ì¼ì€ ì•½ 220pxë¡œ í•´ìƒë„ê°€ ë‚®ìŠµë‹ˆë‹¤. URL íŒŒë¼ë¯¸í„°ë¥¼ ì¡°ì •í•˜ì—¬ ë” ë†’ì€ í•´ìƒë„ì˜ ì¸ë„¤ì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì¸ë„¤ì¼ í¬ê¸° ì¡°ì • í•¨ìˆ˜**:

```typescript
/**
 * Google Drive ì¸ë„¤ì¼ URLì˜ í¬ê¸°ë¥¼ ì¡°ì •í•˜ëŠ” í•¨ìˆ˜
 * @param thumbnailLink ì›ë³¸ ì¸ë„¤ì¼ URL
 * @param size ì›í•˜ëŠ” í¬ê¸° (í”½ì…€ ë‹¨ìœ„, ê¸°ë³¸ê°’: 640)
 * @returns í¬ê¸°ê°€ ì¡°ì •ëœ ì¸ë„¤ì¼ URL
 */
function getOptimizedThumbnailUrl(thumbnailLink: string, size: number = 640): string {
  if (!thumbnailLink) return '';
  
  // Google Drive ì¸ë„¤ì¼ URLì€ ë³´í†µ =s220 ê°™ì€ íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨
  // ì´ë¥¼ ì›í•˜ëŠ” í¬ê¸°ë¡œ ë³€ê²½
  // ì˜ˆ: https://.../thumbnail?sz=s220 -> https://.../thumbnail?sz=s640
  const sizeParam = `=s${size}`;
  
  // URLì— ì´ë¯¸ í¬ê¸° íŒŒë¼ë¯¸í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
  const sizePattern = /=s\d+/;
  if (sizePattern.test(thumbnailLink)) {
    // ê¸°ì¡´ í¬ê¸° íŒŒë¼ë¯¸í„°ë¥¼ ìƒˆë¡œìš´ í¬ê¸°ë¡œ êµì²´
    return thumbnailLink.replace(sizePattern, sizeParam);
  }
  
  // í¬ê¸° íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
  // URLì— ì´ë¯¸ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
  const separator = thumbnailLink.includes('?') ? '&' : '?';
  return `${thumbnailLink}${separator}sz=s${size}`;
}
```

**ê°¤ëŸ¬ë¦¬ ëª©ë¡ì—ì„œ ìµœì í™”ëœ ì¸ë„¤ì¼ ì‚¬ìš©**:

```typescript
// ê°¤ëŸ¬ë¦¬ ëª©ë¡ì—ì„œëŠ” ìµœì í™”ëœ ì¸ë„¤ì¼(640px)ì„ ìš°ì„  ì‚¬ìš©í•˜ì—¬ ë¹ ë¥¸ ë¡œë”©
const optimizedThumbnail = image.thumbnailLink 
  ? getOptimizedThumbnailUrl(image.thumbnailLink, 640) 
  : '';
const imageUrl = optimizedThumbnail || image.webViewLink || image.downloadUrl || image.apiUrl;

// ì‚¬ìš©
<img
  src={imageUrl}
  alt={image.name}
  className="w-full h-auto"
  loading="lazy"
/>
```

**ëª¨ë‹¬ì—ì„œëŠ” ì›ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©**:

```typescript
// ëª¨ë‹¬ì—ì„œëŠ” ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ìš°ì„  ì‚¬ìš©í•˜ì—¬ ê³ í•´ìƒë„ ì´ë¯¸ì§€ ì œê³µ
<img
  src={selectedImage.apiUrl || selectedImage.downloadUrl || selectedImage.thumbnailLink || selectedImage.webViewLink}
  alt={selectedImage.name}
  className="max-w-[90vw] max-h-[90vh] object-contain"
/>
```

**í•´ìƒë„ ë¹„êµ**:
- ê¸°ë³¸ ì¸ë„¤ì¼: ì•½ 220px
- ìµœì í™”ëœ ì¸ë„¤ì¼: 640px (ì•½ 3ë°° í–¥ìƒ)
- ì›ë³¸ ì´ë¯¸ì§€: ì›ë³¸ í•´ìƒë„ (í´ë¦­ ì‹œì—ë§Œ ë¡œë“œ)

**ê¶Œì¥ ì„¤ì •**:
- ê°¤ëŸ¬ë¦¬ ëª©ë¡: 640px ì¸ë„¤ì¼ (ë¹ ë¥¸ ë¡œë”© + ì ì ˆí•œ í’ˆì§ˆ)
- ëª¨ë‹¬/íŒì—…: ì›ë³¸ ì´ë¯¸ì§€ (ê³ í•´ìƒë„)
- í•„ìš”ì‹œ ì¸ë„¤ì¼ í¬ê¸°ë¥¼ 1024pxë¡œ ì¦ê°€ ê°€ëŠ¥

### 7.5 ì´ë¯¸ì§€ íŒì—… (ëª¨ë‹¬) êµ¬í˜„

```typescript
const [selectedImage, setSelectedImage] = useState<DriveImage | null>(null);

// íŒì—… ì—´ê¸°
const openImagePopup = (image: DriveImage) => {
  setSelectedImage(image);
};

// íŒì—… ë‹«ê¸°
const closeImagePopup = () => {
  setSelectedImage(null);
};

// ì‚¬ìš©
{selectedImage && (
  <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center">
    <button
      onClick={closeImagePopup}
      className="absolute top-4 right-4 text-white"
    >
      âœ•
    </button>
    <img
      src={selectedImage.apiUrl} // ê³ í•´ìƒë„ ì´ë¯¸ì§€
      alt={selectedImage.name}
      className="max-w-[90vw] max-h-[90vh] object-contain"
    />
  </div>
)}
```

---

## 8. ë°°í¬

### 8.1 Vercel ë°°í¬ ì‹œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

#### Vercel CLI ì‚¬ìš© (ê¶Œì¥)

```bash
# Vercel ë¡œê·¸ì¸
vercel login

# í”„ë¡œì íŠ¸ ì—°ê²°
vercel link

# í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
echo -n "1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT" | vercel env add DRIVE_FOLDER_ID production
echo -n "google-drive-service@project-id.iam.gserviceaccount.com" | vercel env add GOOGLE_SERVICE_ACCOUNT_EMAIL production
echo -n "-----BEGIN PRIVATE KEY-----\n..." | vercel env add GOOGLE_PRIVATE_KEY production

# Preview, Development í™˜ê²½ì—ë„ ë™ì¼í•˜ê²Œ ì¶”ê°€
echo -n "1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT" | vercel env add DRIVE_FOLDER_ID preview
echo -n "1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT" | vercel env add DRIVE_FOLDER_ID development
```

**âš ï¸ ì¤‘ìš”**: `echo -n`ì„ ì‚¬ìš©í•˜ì—¬ ì¤„ë°”ê¿ˆ ë¬¸ìë¥¼ ì œê±°í•˜ê³  ì¶”ê°€í•˜ì„¸ìš”.

#### Vercel ëŒ€ì‹œë³´ë“œ ì‚¬ìš©

1. Vercel ëŒ€ì‹œë³´ë“œ â†’ í”„ë¡œì íŠ¸ ì„ íƒ
2. **Settings** â†’ **Environment Variables**
3. ê° í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€:
   - **Name**: `DRIVE_FOLDER_ID`
   - **Value**: í´ë” ID (ì¤„ë°”ê¿ˆ ì—†ì´)
   - **Environment**: Production, Preview, Development ëª¨ë‘ ì„ íƒ
4. **Save** í´ë¦­

**âš ï¸ ì£¼ì˜ì‚¬í•­**:

1. **Private Key ì…ë ¥ ì‹œ**:
   - í°ë”°ì˜´í‘œë¡œ ê°ì‹¸ì§€ ë§ê³  ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°
   - ì¤„ë°”ê¿ˆ ë¬¸ì(`\n`)ëŠ” ê·¸ëŒ€ë¡œ í¬í•¨
   - ì•ë’¤ ê³µë°± ì—†ì´

2. **í™˜ê²½ ë³€ìˆ˜ í™•ì¸**:
   ```bash
   vercel env ls
   ```

3. **í™˜ê²½ ë³€ìˆ˜ ì¬ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš°**:
   ```bash
   # ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ ì‚­ì œ
   vercel env rm DRIVE_FOLDER_ID production -y
   
   # ìƒˆë¡œ ì¶”ê°€ (ì¤„ë°”ê¿ˆ ì—†ì´)
   echo -n "1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT" | vercel env add DRIVE_FOLDER_ID production
   ```

### 8.2 ë°°í¬ í›„ í™•ì¸

1. **API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸**:
   ```bash
   curl https://your-domain.com/api/google-drive?page=1
   ```

2. **ì´ë¯¸ì§€ í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸**:
   ```bash
   curl -I https://your-domain.com/api/google-drive/image/[FILE_ID]
   ```

3. **Vercel ë¡œê·¸ í™•ì¸**:
   ```bash
   vercel logs [DEPLOYMENT_URL] --json
   ```

---

## 9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 9.1 í™˜ê²½ ë³€ìˆ˜ ê´€ë ¨ ì˜¤ë¥˜

#### ì˜¤ë¥˜: `í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤`

**ì›ì¸**: í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì´ë¦„ì´ ì˜ëª»ë¨

**í•´ê²°**:
1. `.env.local` íŒŒì¼ í™•ì¸
2. í™˜ê²½ ë³€ìˆ˜ ì´ë¦„ í™•ì¸ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„)
3. Vercel í™˜ê²½ ë³€ìˆ˜ í™•ì¸: `vercel env ls`

#### ì˜¤ë¥˜: `invalid_grant: Invalid grant: account not found`

**ì›ì¸**: 
- Service Account ì´ë©”ì¼ ëì— ì¤„ë°”ê¿ˆ ë¬¸ì(`\n`) í¬í•¨
- Private Key í˜•ì‹ ì˜¤ë¥˜

**í•´ê²°**:
1. ì½”ë“œì—ì„œ `.trim()` ì‚¬ìš© í™•ì¸:
   ```typescript
   const serviceAccountEmail = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL?.trim();
   const privateKey = process.env.GOOGLE_PRIVATE_KEY?.trim();
   ```
2. Vercel í™˜ê²½ ë³€ìˆ˜ ì¬ì„¤ì • (ì¤„ë°”ê¿ˆ ì—†ì´)

#### ì˜¤ë¥˜: `í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (404)`

**ì›ì¸**:
- í´ë” ID ëì— ì¤„ë°”ê¿ˆ ë¬¸ì(`\n`) í¬í•¨
- Service Accountì— í´ë” ê³µìœ  ê¶Œí•œ ì—†ìŒ
- í´ë” IDê°€ ì˜ëª»ë¨

**í•´ê²°**:
1. ì½”ë“œì—ì„œ `.trim()` ì‚¬ìš©:
   ```typescript
   const folderId = process.env.DRIVE_FOLDER_ID?.trim();
   ```
2. Service Accountì— í´ë” ê³µìœ  í™•ì¸:
   - Google Drive â†’ í´ë” ìš°í´ë¦­ â†’ ê³µìœ 
   - Service Account ì´ë©”ì¼ì´ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
   - ê¶Œí•œì´ "ë·°ì–´" ì´ìƒì¸ì§€ í™•ì¸
3. Vercel í™˜ê²½ ë³€ìˆ˜ ì¬ì„¤ì •:
   ```bash
   vercel env rm DRIVE_FOLDER_ID production -y
   echo -n "1lM28bdwDO5QaKlrqMW2uNHiXh1_gk7oT" | vercel env add DRIVE_FOLDER_ID production
   ```

#### ì˜¤ë¥˜: `í´ë” ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤ (403)`

**ì›ì¸**: Service Accountì— í´ë” ê³µìœ  ê¶Œí•œì´ ì—†ìŒ

**í•´ê²°**:
1. Google Driveì—ì„œ í´ë” ê³µìœ  í™•ì¸
2. Service Account ì´ë©”ì¼ë¡œ ê³µìœ  ì¶”ê°€
3. ê¶Œí•œ: "ë·°ì–´" ì´ìƒ ì„¤ì •

### 9.2 ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜

#### ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ

**ì›ì¸**:
- ì´ë¯¸ì§€ í”„ë¡ì‹œ API ì˜¤ë¥˜
- CORS ë¬¸ì œ
- íŒŒì¼ ID ì˜¤ë¥˜

**í•´ê²°**:
1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ â†’ Network íƒ­ í™•ì¸
2. ì´ë¯¸ì§€ í”„ë¡ì‹œ API ì‘ë‹µ í™•ì¸
3. Vercel ë¡œê·¸ í™•ì¸:
   ```bash
   vercel logs [DEPLOYMENT_URL] --json | grep "ì´ë¯¸ì§€ í”„ë¡ì‹œ"
   ```

#### ë‚®ì€ í•´ìƒë„ ì´ë¯¸ì§€ë§Œ í‘œì‹œë¨

**ì›ì¸**: 
- ê¸°ë³¸ `thumbnailLink`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŒ (ì•½ 220px)
- ê°¤ëŸ¬ë¦¬ ëª©ë¡ì—ì„œ ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ë¡œë“œí•˜ê³  ìˆìŒ

**í•´ê²°**:
1. **ê°¤ëŸ¬ë¦¬ ëª©ë¡**: ìµœì í™”ëœ ì¸ë„¤ì¼(640px) ì‚¬ìš©
   ```typescript
   const optimizedThumbnail = image.thumbnailLink 
     ? getOptimizedThumbnailUrl(image.thumbnailLink, 640) 
     : '';
   const imageUrl = optimizedThumbnail || image.webViewLink || image.downloadUrl || image.apiUrl;
   ```

2. **ëª¨ë‹¬/íŒì—…**: ì›ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©
   ```typescript
   src={selectedImage.apiUrl || selectedImage.downloadUrl || ...}
   ```

3. **ì¸ë„¤ì¼ í¬ê¸° ì¡°ì •**: í•„ìš”ì‹œ 1024pxë¡œ ì¦ê°€ ê°€ëŠ¥
   ```typescript
   getOptimizedThumbnailUrl(image.thumbnailLink, 1024)
   ```

### 9.3 API ì‘ë‹µ ì˜¤ë¥˜

#### íƒ€ì… ì˜¤ë¥˜: `implicitly has type 'any'`

**ì›ì¸**: Google Drive API ì‘ë‹µ íƒ€ì…ì´ ë³µì¡í•¨

**í•´ê²°**:
```typescript
// íƒ€ì… ë‹¨ì–¸ ì‚¬ìš©
const response = await drive.files.list({
  // ...
}) as { 
  data: { 
    files?: Array<{ id?: string | null; name?: string | null }>;
    nextPageToken?: string | null;
  } 
};
```

### 9.4 ë°°í¬ ì˜¤ë¥˜

#### ë¹Œë“œ ì˜¤ë¥˜: `Module not found`

**ì›ì¸**: íŒ¨í‚¤ì§€ ë¯¸ì„¤ì¹˜ ë˜ëŠ” ê²½ë¡œ ì˜¤ë¥˜

**í•´ê²°**:
```bash
npm install googleapis
```

#### ëŸ°íƒ€ì„ ì˜¤ë¥˜: í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½

**ì›ì¸**: Vercel í™˜ê²½ ë³€ìˆ˜ ë¯¸ì„¤ì •

**í•´ê²°**:
1. `vercel env ls`ë¡œ í™•ì¸
2. ëˆ„ë½ëœ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€

---

## 10. ì£¼ìš” ì£¼ì˜ì‚¬í•­

### 10.1 ë³´ì•ˆ

1. **Private Key ë³´í˜¸**:
   - ì ˆëŒ€ ê³µê°œ ì €ì¥ì†Œì— ì»¤ë°‹í•˜ì§€ ì•Šê¸°
   - `.env.local`ì€ `.gitignore`ì— í¬í•¨
   - Vercel í™˜ê²½ ë³€ìˆ˜ëŠ” ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë¨

2. **Service Account ê¶Œí•œ**:
   - ìµœì†Œ ê¶Œí•œ ì›ì¹™: `drive.readonly`ë§Œ ì‚¬ìš©
   - í´ë”ë³„ ê³µìœ  ê¶Œí•œ: "ë·°ì–´"ë§Œ ë¶€ì—¬

3. **API í‚¤ ë…¸ì¶œ ë°©ì§€**:
   - í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì§ì ‘ Google Drive API í˜¸ì¶œí•˜ì§€ ì•Šê¸°
   - ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ API í˜¸ì¶œ
   - ì´ë¯¸ì§€ í”„ë¡ì‹œë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ì œê³µ

### 10.2 ì„±ëŠ¥

1. **ì´ë¯¸ì§€ ìµœì í™” ì „ëµ**:
   - **ê°¤ëŸ¬ë¦¬ ëª©ë¡**: ìµœì í™”ëœ ì¸ë„¤ì¼(640px) ì‚¬ìš©
     - ë¹ ë¥¸ ì´ˆê¸° ë¡œë”© (ì›ë³¸ ëŒ€ë¹„ ì•½ 1/10~1/20 í¬ê¸°)
     - ì ì ˆí•œ í’ˆì§ˆ ìœ ì§€
   - **ëª¨ë‹¬/íŒì—…**: ì›ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©
     - í´ë¦­ ì‹œì—ë§Œ ê³ í•´ìƒë„ ì´ë¯¸ì§€ ë¡œë“œ
     - ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
   - **ì¸ë„¤ì¼ í¬ê¸° ì¡°ì •**: `getOptimizedThumbnailUrl()` í•¨ìˆ˜ ì‚¬ìš©
     - ê¸°ë³¸: 640px (ê¶Œì¥)
     - í•„ìš”ì‹œ: 1024pxë¡œ ì¦ê°€ ê°€ëŠ¥

2. **ìºì‹± ì „ëµ**:
   - ì´ë¯¸ì§€ í”„ë¡ì‹œ: `Cache-Control: public, max-age=3600` (1ì‹œê°„)
   - ëª©ë¡ API: `Cache-Control: no-store` (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)

3. **í˜ì´ì§€ë„¤ì´ì…˜**:
   - í˜ì´ì§€ë‹¹ 30ê°œ ì´ë¯¸ì§€ ê¶Œì¥
   - Google Drive API ìµœëŒ€ `pageSize`: 1000

4. **ìë™ ìƒˆë¡œê³ ì¹¨**:
   - 30ì´ˆ ê°„ê²© ê¶Œì¥
   - Page Visibility APIë¡œ íƒ­ ë¹„í™œì„±í™” ì‹œ ì¤‘ì§€

### 10.3 í™˜ê²½ ë³€ìˆ˜ ì²˜ë¦¬

**ë°˜ë“œì‹œ `.trim()` ì‚¬ìš©**:

```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
const folderId = process.env.DRIVE_FOLDER_ID?.trim();
const serviceAccountEmail = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL?.trim();
const privateKey = process.env.GOOGLE_PRIVATE_KEY?.trim();

// âŒ ì˜ëª»ëœ ë°©ë²• (ì¤„ë°”ê¿ˆ ë¬¸ìë¡œ ì¸í•œ ì˜¤ë¥˜)
const folderId = process.env.DRIVE_FOLDER_ID;
```

**Private Key ì²˜ë¦¬**:

```typescript
// 1. í°ë”°ì˜´í‘œ ì œê±°
let cleanedPrivateKey = privateKey.replace(/^["']|["']$/g, '');
// 2. ì´ìŠ¤ì¼€ì´í”„ëœ \nì„ ì‹¤ì œ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë³€í™˜
const formattedPrivateKey = cleanedPrivateKey.replace(/\\n/g, '\n');
```

### 10.4 Vercel ë°°í¬ ì‹œ ì£¼ì˜ì‚¬í•­

1. **í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€ ì‹œ**:
   - `echo -n` ì‚¬ìš©í•˜ì—¬ ì¤„ë°”ê¿ˆ ì œê±°
   - ëª¨ë“  í™˜ê²½(Production, Preview, Development)ì— ì¶”ê°€

2. **í™˜ê²½ ë³€ìˆ˜ ì¬ì„¤ì •**:
   - ë¬¸ì œ ë°œìƒ ì‹œ ì‚­ì œ í›„ ì¬ì¶”ê°€
   - ì¤„ë°”ê¿ˆ ì—†ì´ ì¶”ê°€

3. **ë¡œê·¸ í™•ì¸**:
   - ë°°í¬ í›„ ì¦‰ì‹œ ë¡œê·¸ í™•ì¸
   - ì˜¤ë¥˜ ë°œìƒ ì‹œ ìƒì„¸ ë¡œê·¸ ë¶„ì„

### 10.5 ì½”ë“œ í’ˆì§ˆ

1. **ì—ëŸ¬ ì²˜ë¦¬**:
   - ëª¨ë“  API í˜¸ì¶œì— try-catch ì‚¬ìš©
   - ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
   - ê°œë°œ í™˜ê²½ì—ì„œë§Œ ìƒì„¸ ì—ëŸ¬ ì •ë³´ í‘œì‹œ

2. **ë¡œê¹…**:
   - ì¤‘ìš”í•œ ë‹¨ê³„ë§ˆë‹¤ `console.log` ì¶”ê°€
   - ë°°í¬ í™˜ê²½ì—ì„œë„ ë””ë²„ê¹… ê°€ëŠ¥í•˜ë„ë¡

3. **íƒ€ì… ì•ˆì •ì„±**:
   - TypeScript íƒ€ì… ì •ì˜
   - Google Drive API ì‘ë‹µ íƒ€ì… ë‹¨ì–¸

---

## 11. ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸ ì‚¬í•­:

- [ ] Google Cloud Consoleì—ì„œ Google Drive API í™œì„±í™”
- [ ] Service Account ìƒì„± ë° JSON í‚¤ ë‹¤ìš´ë¡œë“œ
- [ ] Google Drive í´ë”ì— Service Account ê³µìœ  (ë·°ì–´ ê¶Œí•œ)
- [ ] `.env.local` íŒŒì¼ ìƒì„± ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ì— `.trim()` ì ìš©
- [ ] Private Key ì²˜ë¦¬ ì½”ë“œ í™•ì¸ (í°ë”°ì˜´í‘œ ì œê±°, `\n` ë³€í™˜)
- [ ] ë¡œì»¬ì—ì„œ API í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ëª¨ë“  í™˜ê²½)
- [ ] Vercel ë°°í¬ í›„ API í…ŒìŠ¤íŠ¸
- [ ] ì´ë¯¸ì§€ í”„ë¡ì‹œ API í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ê°¤ëŸ¬ë¦¬ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] ìë™ ìƒˆë¡œê³ ì¹¨ ì •ìƒ ì‘ë™ í™•ì¸

---

## 12. ì°¸ê³  ìë£Œ

- [Google Drive API v3 ë¬¸ì„œ](https://developers.google.com/drive/api/v3/about-sdk)
- [Google APIs Node.js Client](https://github.com/googleapis/google-api-nodejs-client)
- [Next.js API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)

---

## 13. ì˜ˆì œ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
your-project/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ api/
â”‚       â”‚   â””â”€â”€ google-drive/
â”‚       â”‚       â”œâ”€â”€ route.ts                    # GET /api/google-drive
â”‚       â”‚       â””â”€â”€ image/
â”‚       â”‚           â””â”€â”€ [fileId]/
â”‚       â”‚               â””â”€â”€ route.ts            # GET /api/google-drive/image/[fileId]
â”‚       â””â”€â”€ results/
â”‚           â””â”€â”€ page.tsx                        # ê°¤ëŸ¬ë¦¬ í˜ì´ì§€
â”œâ”€â”€ .env.local                                  # ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜ (gitignore)
â”œâ”€â”€ .gitignore                                 # .env.local í¬í•¨ í™•ì¸
â”œâ”€â”€ package.json                               # googleapis í¬í•¨ í™•ì¸
â””â”€â”€ ê°€ì´ë“œë¼ì¸.md                               # ì´ ë¬¸ì„œ
```

---

**ì‘ì„±ì¼**: 2025ë…„ 12ì›” 14ì¼  
**ì‘ì„±ì**: AI Assistant  
**í”„ë¡œì íŠ¸**: EduFarm - Google Drive ì‚¬ì§„ ê°¤ëŸ¬ë¦¬

---

ì´ ê°€ì´ë“œë¼ì¸ì„ ë”°ë¼í•˜ë©´ Google Drive í´ë”ì˜ ì‚¬ì§„ì„ ì›¹ì—ì„œ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì„œë¹„ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¸ì œê°€ ë°œìƒí•˜ë©´ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì„¹ì…˜ì„ ì°¸ê³ í•˜ì„¸ìš”.
